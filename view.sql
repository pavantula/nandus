ALTER DEFINER = 'feedbackoutlook_fo'@'localhost' VIEW current_plan_info AS select `pln`.`subscribed_by` AS `subscribed_by`,`pln`.`subscribe_id` AS `subscribe_id`,`pln`.`invoice_flag` AS `inv_flag`,date_format(`pln`.`subscribed_on`,'%Y-%m-%d') AS `subscribed_on`,date_format(`pln`.`valid_till`,'%Y-%m-%d') AS `valid_till`,`pln`.`valid_till` AS `valid_till_current`,`mgr`.`plan_name` AS `plan_name`,`mgr`.`plan_amt` AS `plan_amt`,`pln`.`plan_id` AS `plan_id`,`mgr`.`email_allowed` AS `email_allowed`,`mgr`.`camp_allowed` AS `camp_allowed`,`mgr`.`hijack_alert` AS `hijack_alert`,count(`ord`.`camp_id`) AS `sent_count`,(`mgr`.`email_allowed` - count(`ord`.`camp_id`)) AS `remaining_email`,if(((date_format(`pln`.`valid_till`,'%Y-%m-%d') > now()) and (`mx_pln`.`cp_count` = '1')),'Free Trail',if(((date_format(`pln`.`valid_till`,'%Y-%m-%d') > now()) and (`mx_pln`.`cp_count` > '1')),'Paid','Inactive')) AS `plan_status`,`bal`.`current_amt` AS `wallet_balance`,`feedbackgrid`.`scr_user`.`auto_addon` AS `auto_addon`,ifnull(`adon`.`current_amt`,0) AS `addon_balance`,ifnull(`adon`.`available_email`,0) AS `addon_available_email`,ifnull(`adon`.`email_remaining`,0) AS `addon_email_remaining` from ((((((((`feedbackgrid`.`plan_subscriber` `pln` join `feedbackgrid`.`mx_valid_plan_per_user` `mx_pln` on(((`pln`.`subscribed_by` = `mx_pln`.`subscriber`) and (`mx_pln`.`recent_subscribe` = `pln`.`subscribe_id`)))) join `feedbackgrid`.`payment_details` `pym` on((`pym`.`payment_id` = `pln`.`payment_id`))) join `feedbackgrid`.`plan_manager` `mgr` on((`mgr`.`plan_id` = `pln`.`plan_id`))) join `feedbackgrid`.`scr_user` on((`feedbackgrid`.`scr_user`.`scr_u_id` = `pln`.`subscribed_by`))) left join `feedbackgrid`.`campaign_manager` `cpn` on((`pln`.`subscribed_by` = `cpn`.`created_by`))) left join `feedbackgrid`.`campaign_order_list` `ord` on(((`cpn`.`cpgn_id` = `ord`.`camp_id`) and (`ord`.`sent_on` > cast(`pln`.`subscribed_on` as date)) and (`ord`.`sent_on` < cast(`pln`.`valid_till` as date))))) left join `feedbackgrid`.`addon_status` `adon` on((`feedbackgrid`.`scr_user`.`scr_u_id` = `adon`.`user_id`))) left join `feedbackgrid`.`current_balance` `bal` on((`bal`.`user_id` = `feedbackgrid`.`scr_user`.`scr_u_id`))) group by `pln`.`subscribed_by`